;************************************************************
; Programme: Vendredi.txt
;
; DESCRIPTION : Les années valides
; sont de 2000 à 2050.
;
; Auteurs: Jean-Michel Landry, Patrick Chalifour
; Codes permanents : LANJ09049206, CHAP03089503
; Courriel: landry.jean-michel.2@courrier.uqam.ca , dj991063@ens.uqam.ca
; date: 20 avril 2020
; cours: INF2171
;*************************************************************
;
;Programme principal qui appel les sous programmes nécessaires
;
         CALL    bonjour     
debut:   CALL    question    
         CALL    reinit      
         CALL    saisi       
         CPA     -1,i        
         BREQ    debut       
         CALL    premjour    
         CALL    premjeu     
;CALL jourpaie
         CALL    STRBUILD    
         BR      debut       
;
; affiche le message de bienvenu et le fonctionnement du programme.
;
bonjour: STRO    bienvenu,d  
         STRO    manuel,d    
         RET0                
;
; affiche la demande de saisie a l'utilisateur.
;
question:STRO    demande,d   
         RET0                
; Sous-Programme: reinit
; description: Reinitialise les valeurs de alphab , compte, annee et mois
; variables a 0
reinit:  LDA     0,i         
         LDX     0,i         
         STA     compte,d    
         STA     annee,d     
         STA     mois,d      
retalpha:STA     date,x      
         ADDX    1,i         
         CPX     7,i         
         BREQ    ret         
         BR      retalpha    
ret:     RET0                
;
; Sous programme qui saisi une chaine de caractere
; entrez par l'usager et valide que les characteres saisi sont des nombres.
; Il appelle ensuite un autre sous programme qui converti la saisi en annee
; et en mois pour utilisation ulterieur dans le programme. Ainsi qu'un sous
; programme qui valide que l'annee donner par l'utilisateur est valide.
;
saisi:   LDX     0,i         
         LDA     0,i         
lecture: CHARI   date,x      ; lecture d'un caractère de chaine
         LDA     0,i         
         LDBYTEA date,x      ; charge le caractère lu
         ADDX    1,i         ; position suivante
         CPA     '\n',i      
         BRNE    lecture     
         LDX     0,i         
         LDA     0,i         
analyse: LDBYTEA date,x      
         CPA     '\n',i      
         BREQ    finchain    
         ADDX    1,i         
         CPA     '0',i       
         BRLT    inval       
         CPA     '9',i       
         BRGT    inval       
         SUBA    48,i        
         STBYTEA datedec,x   
         CPX     6,i         
         BREQ    finchain    
         BR      analyse     
finchain:CPX     0,i         ; est-ce que le caractère ENTREE est le premier caractère lu
         BREQ    fin         
         CALL    converti    
         CALL    valideur    
retoure: RET0                
inval:   STRO    entinval,d  
         LDA     -1,i        
         BR      retoure     
; Sous programme qui valide que la date entree est entre les bornes 1901 et 2050.
;
valideur:LDA     0,i         
         LDX     0,i         
         LDA     annee,d     
         CPA     1901,i      
         BRLT    inval       
         CPA     2050,i      
         BRGT    inval       
         LDA     mois,d      
         CPA     12,i        
         BRGT    inval       
         RET0                
;
;Sous programme qui prend la date au long dans le champ date et la separe
;en mois et en annee
;
converti:LDA     0,i         
         LDX     1,i         
         LDBYTEA datedec,x   
         LDX     1000,i      
         CALL    mult        
         STA     annee,d     
         LDA     0,i         
         LDX     2,i         
         LDBYTEA datedec,x   
         LDX     100,i       
         CALL    mult        
         ADDA    annee,d     
         STA     annee,d     
         LDA     0,i         
         LDX     3,i         
         LDBYTEA datedec,x   
         LDX     10,i        
         CALL    mult        
         ADDA    annee,d     
         STA     annee,d     
         LDA     0,i         
         LDX     4,i         
         LDBYTEA datedec,x   
         ADDA    annee,d     
         STA     annee,d     
         LDA     0,i         
         LDX     5,i         
         LDBYTEA datedec,x   
         LDX     10,i        
         CALL    mult        
         ADDA    mois,d      
         STA     mois,d      
         LDA     0,i         
         LDX     6,i         
         LDBYTEA datedec,x   
         ADDA    mois,d      
         STA     mois,d      
         RET0                
;
;Sous programme pour calculer la premiere journee du mois et retourne l'indice en A
; Il trouve d'abord le nombre de jour ecouler depuis 1900 puis apelle un programme de
; division speciale pour trouver le reste. Celui-ci retourne l'indice du jour(dimanche = 0).
; Puis ce programme retourne l'indice du jour.
;
premjour:LDA     0,i         
         LDX     0,i         
;aaxx <- aaaa - 1900
;aaxx * 365 mais
;aaxx*365 => aaxx*(364+1) => aaxx*(1) => aaxx , car 364 est un multiple de 7
         LDA     annee,d     
         SUBA    1900,i      
         STA     aaxx,d      
         STA     compte,d    
;+ entier((aaxx-1) / 4)
         LDA     aaxx,d      
         SUBA    1,i         
         LDX     4,i         
         CALL    divise      
         ADDX    compte,d    
         STX     compte,d    
;+ entier((((mm - 1) * 57) + 50) / 100)
         LDA     mois,d      
         CPA     2,i         
         BRGT    retranch    
         BR      bissex      
retranch:LDX     aaxx,d      ; analysons le nombre d'année depuis 1900
         ANDX    3,i         ; divisible par 4 ?
         BREQ    bissex      ; oui, on enlève 1
nonbisse:SUBA    1,i         ; -1 pour l'année non bissextile
bissex:  SUBA    1,i         ; -2 pour l'année non bissextile ou -1 pour bissextile
         LDX     57,i        
         CALL    mult        
         ADDA    50,i        
         LDX     100,i       
         CALL    divise      
         ADDX    compte,d    
         STX     compte,d    
;+ (mm - 1) * 30
         LDA     mois,d      
         SUBA    1,i         
         LDX     30,i        
         CALL    mult        
         ADDA    compte,d    
         STA     compte,d    
;+ jj le premier jour donc 1
         LDA     1,i         
         ADDA    compte,d    
         STA     jours,d     ; le nombre de jours écoulés
; divison par 7 pour avoir l'indice du jour (dimanche = 0)
         LDX     7,i         
         CALL    divise      
         STA     jourun,d    ; indice du premier jour
         DECO    jourun,d    
         RET0                
;
; Sous programme qui trouve la date du premier jeudi du mois.
;
premjeu: LDX     1,i         
         STX     compte,d    
         LDA     jourun,d    
boucl:   CPA     4,i         
         BREQ    jeudi       
         CPA     11,i        
         BREQ    jeudi       
         ADDA    1,i         
         ADDX    1,i         
         BR      boucl       
jeudi:   STX     jeuprem,d   
         ADDX    jours,d     
         STX     jours,d     
         RET0                
;
; Sous programme qui trouve si les jeudis du mois qui sont un jour de paie. Il range les
; dates dans un tableau nommés jourspai.
;
jourpaie:LDA     jours,d     
         LDX     14,i        
         CALL    divise      
         CPA     4,i         
         BREQ    oui         
         LDA     jeuprem,d   
oui:     LDX     0,i         
         LDA     jeuprem,d   
         STA     jourspai,x  
         ADDX    1,i         
         ADDA    14,i        
         CPA     31,i        
         BRGE    term        
         CPA     28,i        
         BRGT    verimois    
         BR      oui         
verimois:LDA     mois,d      
         CPA     2,i         
         BREQ    fevrier     
         BR      oui         
fevrier: LDA     ' ',i       
         STA     jourspai,x  
         BR      term        
term:    RET0                
;
;       Sous programme qui initialise un texte avec des espaces vides
;       Puis selon le mois il cherche dans un texte pour afficher le bon
;       en characteres.
;
STRBUILD:LDX     0,i         
         LDBYTEA "\n",i      
         STBYTEA SORTIE,x    
         ADDX    1,i         
         LDA     "  ",i      
espace:  STA     SORTIE,x    
         ADDX    2,i         
         CPX     500,i       
         BRLT    espace      
         LDA     mois,d      
         CPA     1,i         
         BREQ    JANVIER     
         CPA     2,i         
         BREQ    FEVRIER     
         CPA     3,i         
         BREQ    MARS        
         CPA     4,i         
         BREQ    AVRIL       
         CPA     5,i         
         BREQ    MAI         
         CPA     6,i         
         BREQ    JUIN        
         CPA     7,i         
         BREQ    JUILLET     
         CPA     8,i         
         BREQ    AOUT        
         CPA     9,i         
         BREQ    SEPTEMBR    
         CPA     10,i        
         BREQ    OCTOBRE     
         CPA     11,i        
         BREQ    NOVEMBRE    
         CPA     12,i        
         BREQ    DECEMBRE    
;
;        nous désirons copier le mot SUCCES dans la ligne de sortie
;        à partir du 6ième caractère
;
JANVIER: LDA     TEXTE,i     ; chaine d'origine
         STA     -2,s        
         LDA     0,i         ; premier caractère
         STA     -4,s        
         LDA     SORTIE,i    ; chaine de destination
         STA     -6,s        
         LDA     10,i        ;10 caractère
         STA     -8,s        
         ADDA    6,i         ; longueur de 7 caractères
         STA     -10,s       
         SUBSP   10,i        ; #chaineO #positioO #chaineD #positioD #limite
         CALL    RECOPIE     
         LDA     date,i      ; chaine d'origine
         STA     -2,s        
         LDA     0,i         ; premier caractère
         STA     -4,s        
         LDA     SORTIE,i    ; chaine de destination
         STA     -6,s        
         LDA     18,i        ;18e caractère
         STA     -8,s        
         ADDA    3,i         ; longueur de 7 caractères
         STA     -10,s       
         SUBSP   10,i        ; #chaineO #positioO #chaineD #positioD #limite
         CALL    RECOPIE     
         BR      AFFICHE     
FEVRIER: LDA     TEXTE,i     ; chaine d'origine
         STA     -2,s        
         LDA     8,i         ; 10ième caractère
         STA     -4,s        
         LDA     SORTIE,i    ; chaine de destination
         STA     -6,s        
         LDA     10,i        ; 10ième caractère
         STA     -8,s        
         ADDA    6,i         ; longueur de 7 caractères
         STA     -10,s       
         SUBSP   10,i        ; #chaineO #positioO #chaineD #positioD #limite
         CALL    RECOPIE     ; #retour
         LDA     date,i      ; chaine d'origine
         STA     -2,s        
         LDA     0,i         ; premier caractère
         STA     -4,s        
         LDA     SORTIE,i    ; chaine de destination
         STA     -6,s        
         LDA     18,i        ;10e caractère
         STA     -8,s        
         ADDA    3,i         ; longueur de 7 caractères
         STA     -10,s       
         SUBSP   10,i        ; #chaineO #positioO #chaineD #positioD #limite
         CALL    RECOPIE     
         BR      AFFICHE     
MARS:    LDA     TEXTE,i     ; chaine d'origine
         STA     -2,s        
         LDA     16,i        ; 10ième caractère
         STA     -4,s        
         LDA     SORTIE,i    ; chaine de destination
         STA     -6,s        
         LDA     10,i        ; 10ième caractère
         STA     -8,s        
         ADDA    3,i         ; longueur de 4 caractères
         STA     -10,s       
         SUBSP   10,i        ; #chaineO #positioO #chaineD #positioD #limite
         CALL    RECOPIE     ; #retour
         LDA     date,i      ; chaine d'origine
         STA     -2,s        
         LDA     0,i         ; premier caractère
         STA     -4,s        
         LDA     SORTIE,i    ; chaine de destination
         STA     -6,s        
         LDA     15,i        ;10e caractère
         STA     -8,s        
         ADDA    3,i         ; longueur de 3 caractères
         STA     -10,s       
         SUBSP   10,i        ; #chaineO #positioO #chaineD #positioD #limite
         CALL    RECOPIE     
         BR      AFFICHE     
AVRIL:   LDA     TEXTE,i     ; chaine d'origine
         STA     -2,s        
         LDA     21,i        ; 10ième caractère
         STA     -4,s        
         LDA     SORTIE,i    ; chaine de destination
         STA     -6,s        
         LDA     10,i        ; 12ième caractère
         STA     -8,s        
         ADDA    4,i         ; longueur de 5 caractères
         STA     -10,s       
         SUBSP   10,i        ; #chaineO #positioO #chaineD #positioD #limite
         CALL    RECOPIE     ; #retour
         LDA     date,i      ; chaine d'origine
         STA     -2,s        
         LDA     0,i         ; premier caractère
         STA     -4,s        
         LDA     SORTIE,i    ; chaine de destination
         STA     -6,s        
         LDA     16,i        ;10e caractère
         STA     -8,s        
         ADDA    3,i         ; longueur de 3 caractères
         STA     -10,s       
         SUBSP   10,i        ; #chaineO #positioO #chaineD #positioD #limite
         CALL    RECOPIE     
         BR      AFFICHE     
MAI:     LDA     TEXTE,i     ; chaine d'origine
         STA     -2,s        
         LDA     27,i        ; 10ième caractère
         STA     -4,s        
         LDA     SORTIE,i    ; chaine de destination
         STA     -6,s        
         LDA     10,i        ; 12ième caractère
         STA     -8,s        
         ADDA    2,i         ; longueur de 7 caractères
         STA     -10,s       
         SUBSP   10,i        ; #chaineO #positioO #chaineD #positioD #limite
         CALL    RECOPIE     ; #retour
         LDA     date,i      ; chaine d'origine
         STA     -2,s        
         LDA     0,i         ; premier caractère
         STA     -4,s        
         LDA     SORTIE,i    ; chaine de destination
         STA     -6,s        
         LDA     14,i        ;10e caractère
         STA     -8,s        
         ADDA    3,i         ; longueur de 3 caractères
         STA     -10,s       
         SUBSP   10,i        ; #chaineO #positioO #chaineD #positioD #limite
         CALL    RECOPIE     
         BR      AFFICHE     
JUIN:    LDA     TEXTE,i     ; chaine d'origine
         STA     -2,s        
         LDA     31,i        ; 10ième caractère
         STA     -4,s        
         LDA     SORTIE,i    ; chaine de destination
         STA     -6,s        
         LDA     10,i        ; 12ième caractère
         STA     -8,s        
         ADDA    3,i         ; longueur de 7 caractères
         STA     -10,s       
         SUBSP   10,i        ; #chaineO #positioO #chaineD #positioD #limite
         CALL    RECOPIE     ; #retour
         LDA     date,i      ; chaine d'origine
         STA     -2,s        
         LDA     0,i         ; premier caractère
         STA     -4,s        
         LDA     SORTIE,i    ; chaine de destination
         STA     -6,s        
         LDA     15,i        ;10e caractère
         STA     -8,s        
         ADDA    3,i         ; longueur de 3 caractères
         STA     -10,s       
         SUBSP   10,i        ; #chaineO #positioO #chaineD #positioD #limite
         CALL    RECOPIE     
         BR      AFFICHE     
JUILLET: LDA     TEXTE,i     ; chaine d'origine
         STA     -2,s        
         LDA     36,i        ; 10ième caractère
         STA     -4,s        
         LDA     SORTIE,i    ; chaine de destination
         STA     -6,s        
         LDA     10,i        ; 12ième caractère
         STA     -8,s        
         ADDA    6,i         ; longueur de 7 caractères
         STA     -10,s       
         SUBSP   10,i        ; #chaineO #positioO #chaineD #positioD #limite
         CALL    RECOPIE     ; #retour
         LDA     date,i      ; chaine d'origine
         STA     -2,s        
         LDA     0,i         ; premier caractère
         STA     -4,s        
         LDA     SORTIE,i    ; chaine de destination
         STA     -6,s        
         LDA     18,i        ;10e caractère
         STA     -8,s        
         ADDA    3,i         ; longueur de 3 caractères
         STA     -10,s       
         SUBSP   10,i        ; #chaineO #positioO #chaineD #positioD #limite
         CALL    RECOPIE     
         BR      AFFICHE     
AOUT:    LDA     TEXTE,i     ; chaine d'origine
         STA     -2,s        
         LDA     44,i        ; 10ième caractère
         STA     -4,s        
         LDA     SORTIE,i    ; chaine de destination
         STA     -6,s        
         LDA     10,i        ; 12ième caractère
         STA     -8,s        
         ADDA    3,i         ; longueur de 7 caractères
         STA     -10,s       
         SUBSP   10,i        ; #chaineO #positioO #chaineD #positioD #limite
         CALL    RECOPIE     ; #retour
         LDA     date,i      ; chaine d'origine
         STA     -2,s        
         LDA     0,i         ; premier caractère
         STA     -4,s        
         LDA     SORTIE,i    ; chaine de destination
         STA     -6,s        
         LDA     15,i        ;10e caractère
         STA     -8,s        
         ADDA    3,i         ; longueur de 3 caractères
         STA     -10,s       
         SUBSP   10,i        ; #chaineO #positioO #chaineD #positioD #limite
         CALL    RECOPIE     
         BR      AFFICHE     
SEPTEMBR:LDA     TEXTE,i     ; chaine d'origine
         STA     -2,s        
         LDA     49,i        ; 10ième caractère
         STA     -4,s        
         LDA     SORTIE,i    ; chaine de destination
         STA     -6,s        
         LDA     10,i        ; 12ième caractère
         STA     -8,s        
         ADDA    8,i         ; longueur de 7 caractères
         STA     -10,s       
         SUBSP   10,i        ; #chaineO #positioO #chaineD #positioD #limite
         CALL    RECOPIE     ; #retour
         LDA     date,i      ; chaine d'origine
         STA     -2,s        
         LDA     0,i         ; premier caractère
         STA     -4,s        
         LDA     SORTIE,i    ; chaine de destination
         STA     -6,s        
         LDA     20,i        ;10e caractère
         STA     -8,s        
         ADDA    3,i         ; longueur de 3 caractères
         STA     -10,s       
         SUBSP   10,i        ; #chaineO #positioO #chaineD #positioD #limite
         CALL    RECOPIE     
         BR      AFFICHE     
OCTOBRE: LDA     TEXTE,i     ; chaine d'origine
         STA     -2,s        
         LDA     59,i        ; 10ième caractère
         STA     -4,s        
         LDA     SORTIE,i    ; chaine de destination
         STA     -6,s        
         LDA     10,i        ; 12ième caractère
         STA     -8,s        
         ADDA    6,i         ; longueur de 7 caractères
         STA     -10,s       
         SUBSP   10,i        ; #chaineO #positioO #chaineD #positioD #limite
         CALL    RECOPIE     ; #retour
         LDA     date,i      ; chaine d'origine
         STA     -2,s        
         LDA     0,i         ; premier caractère
         STA     -4,s        
         LDA     SORTIE,i    ; chaine de destination
         STA     -6,s        
         LDA     18,i        ;10e caractère
         STA     -8,s        
         ADDA    3,i         ; longueur de 3 caractères
         STA     -10,s       
         SUBSP   10,i        ; #chaineO #positioO #chaineD #positioD #limite
         CALL    RECOPIE     
         BR      AFFICHE     
NOVEMBRE:LDA     TEXTE,i     ; chaine d'origine
         STA     -2,s        
         LDA     67,i        ; 10ième caractère
         STA     -4,s        
         LDA     SORTIE,i    ; chaine de destination
         STA     -6,s        
         LDA     10,i        ; 12ième caractère
         STA     -8,s        
         ADDA    7,i         ; longueur de 7 caractères
         STA     -10,s       
         SUBSP   10,i        ; #chaineO #positioO #chaineD #positioD #limite
         CALL    RECOPIE     ; #retour
         LDA     date,i      ; chaine d'origine
         STA     -2,s        
         LDA     0,i         ; premier caractère
         STA     -4,s        
         LDA     SORTIE,i    ; chaine de destination
         STA     -6,s        
         LDA     19,i        ;10e caractère
         STA     -8,s        
         ADDA    3,i         ; longueur de 3 caractères
         STA     -10,s       
         SUBSP   10,i        ; #chaineO #positioO #chaineD #positioD #limite
         CALL    RECOPIE     
         BR      AFFICHE     
DECEMBRE:LDA     TEXTE,i     ; chaine d'origine
         STA     -2,s        
         LDA     76,i        ; 10ième caractère
         STA     -4,s        
         LDA     SORTIE,i    ; chaine de destination
         STA     -6,s        
         LDA     10,i        ; 12ième caractère
         STA     -8,s        
         ADDA    7,i         ; longueur de 7 caractères
         STA     -10,s       
         SUBSP   10,i        ; #chaineO #positioO #chaineD #positioD #limite
         CALL    RECOPIE     ; #retour
         LDA     date,i      ; chaine d'origine
         STA     -2,s        
         LDA     0,i         ; premier caractère
         STA     -4,s        
         LDA     SORTIE,i    ; chaine de destination
         STA     -6,s        
         LDA     19,i        ;10e caractère
         STA     -8,s        
         ADDA    3,i         ; longueur de 3 caractères
         STA     -10,s       
         SUBSP   10,i        ; #chaineO #positioO #chaineD #positioD #limite
         CALL    RECOPIE     
AFFICHE: LDA     "\n\n",i    
         LDX     24,i        
         STA     SORTIE,x    
         LDA     TEXTE,i     ; chaine d'origine
         STA     -2,s        
         LDA     85,i        ; premier caractère
         STA     -4,s        
         LDA     SORTIE,i    ; chaine de destination
         STA     -6,s        
         LDA     32,i        ;10e caractère
         STA     -8,s        
         ADDA    19,i        ; longueur de 7 caractères
         STA     -10,s       
         SUBSP   10,i        ; #chaineO #positioO #chaineD #positioD #limite
         CALL    RECOPIE     
         LDBYTEA "\n",i      
         LDX     52,i        
         STBYTEA SORTIE,x    
         CALL    affJours    
         STRO    SORTIE,d    
         RET0                
;
; affiche les journee du mois
;
jmois:   .EQUATE 0           
jsem:    .EQUATE 2           
jAff:    .EQUATE 4           
affJours:SUBSP   6,i         ;WARNING: Number of bytes allocated (6) not equal to number of bytes listed in trace tag (0).
         LDA     1,i         
         STA     jAff,s      
         LDA     mois,d      
         CALL    lgtmois     
         STX     jmois,s     
         LDA     59,i        
         STA     compte,d    
         LDA     0,i         
         STA     jsem,s      
blanc:   LDA     jsem,s      
         CPA     jourun,d    
         BREQ    uncharac    
         LDX     compte,d    
         ADDX    3,i         
         STX     compte,d    
         LDA     jsem,s      
         ADDA    1,i         
         STA     jsem,s      
         BR      blanc       
uncharac:LDA     jAff,s      
         ADDA    jAff,s      
         SUBA    1,i         
         STA     ind,d       
         LDA     jAff,s      
         CPA     10,i        
         BRGT    deuxchar    
         LDA     CHIFFRES,i  ; chaine d'origine
         STA     -2,s        
         LDA     ind,d       ; 10ième caractère
         STA     -4,s        
         LDA     SORTIE,i    ; chaine de destination
         STA     -6,s        
         LDA     compte,d    ; 12ième caractère
         STA     -8,s        
         ADDA    0,i         ; longueur de 5 caractères
         STA     -10,s       
         SUBSP   10,i        ; #chaineO #positioO #chaineD #positioD #limite
         CALL    RECOPIE     ; #retour
         LDX     compte,d    
         ADDX    3,i         
         STX     compte,d    
         BR      fait        
deuxchar:LDA     CHIFFRES,i  ; chaine d'origine
         STA     -2,s        
         LDA     ind,d       ; 10ième caractère
         STA     -4,s        
         LDA     SORTIE,i    ; chaine de destination
         STA     -6,s        
         LDA     compte,d    ; 12ième caractère
         STA     -8,s        
         ADDA    0,i         ; longueur de 2 caractères
         STA     -10,s       
         SUBSP   10,i        ; #chaineO #positioO #chaineD #positioD #limite
         CALL    RECOPIE     ; #retour
         LDX     compte,d    
         ADDX    2,i         
         STX     compte,d    
fait:    LDA     jAff,s      
         ADDA    1,i         
         STA     jAff,s      
         LDA     jsem,s      
         ADDA    1,i         
         STA     jsem,s      
         CPA     7,i         
         BREQ    ind0        
         LDA     jAff,s      
         CPA     jmois,s     
         BREQ    fini        
         BR      uncharac    
ind0:    LDA     0,i         
         STA     jsem,s      
         LDX     compte,d    
         ADDX    2,i         
         LDBYTEA "\n",i      
         STBYTEA SORTIE,x    
         ADDX    7,i         
         STX     compte,d    
         BR      uncharac    
fini:    LDA     "\n\n",i    
         STA     SORTIE,x    
         ADDX    7,i         
         STX     compte,d    
         LDA     TEXTPAIE,i  ; chaine d'origine
         STA     -2,s        
         LDA     0,i         ; 10ième caractère
         STA     -4,s        
         LDA     SORTIE,i    ; chaine de destination
         STA     -6,s        
         LDA     compte,d    ; 12ième caractère
         STA     -8,s        
         ADDA    13,i        ; longueur de 2 caractères
         STA     -10,s       
         SUBSP   10,i        ; #chaineO #positioO #chaineD #positioD #limite
         CALL    RECOPIE     ; #retour
         ADDX    14,i        
         DECO    jeuprem,d   
         LDA     jeuprem,d   
         ADDA    48,i        
         STA     SORTIE,x    
         SUBA    48,i        
         ADDX    2,i         
         ADDA    14,i        
         STA     SORTIE,x    
         CPA     31,i        
         BREQ    finit       
         ADDX    2,i         
         ADDA    14,i        
         STA     SORTIE,x    
         BR      finit       
finit:   ADDSP   6,i         ;WARNING: Number of bytes deallocated (6) not equal to number of bytes listed in trace tag (0).
         RET0                
;
;        sous-programme RECOPIE
;
;paramètres:     adresse de la chaine d'origine
;                position du caractère dans la chaine d'origine
;                adresse de la chaine de destination
;                position du caractère dans la chaine de destination
;                position limite dans la chaine de destination
;
sauveX:  .EQUATE 0           ; #2h
sauveA:  .EQUATE 2           ; #2h
retour:  .EQUATE 4           ; #2h
limite:  .EQUATE 6           ; #2d
positioD:.EQUATE 8           ; position destination #2d
chaineD: .EQUATE 10          ; chaine destination #2h
positioO:.EQUATE 12          ; position origine #2d
chaineO: .EQUATE 14          ; chaine origine #2h
;
RECOPIE: SUBSP   4,i         ; #sauveX #sauveA
         STX     sauveX,s    
         STA     sauveA,s    
;
         LDA     0,i         
boucle:  LDX     positioO,s  ; position de départ
         LDA     chaineO,sxf ; caractère à copier
         ADDX    1,i         ; caractère suivant
         STX     positioO,s  
         LDX     positioD,s  ; position d'arrivée
         STA     chaineD,sxf ; caractère qui est copié
         ADDX    1,i         ; caractère suivant
         STX     positioD,s  
         CPX     limite,s    ; dernier caractère copié ?
         BRLT    boucle      ; non, on continue
;
         LDA     retour,s    
         STA     chaineO,s   
         LDA     sauveA,s    
         LDX     sauveX,s    
         ADDSP   14,i        ; #sauveX #sauveA #retour #limite #positioD #chaineD #positioO
         RET0                
;
; Sous programme qui multiplie le nombre en A par le nombre en X. Il retourne le resultat
; dans le registre A.
;
nombre:  .EQUATE 0           
mult:    SUBSP   2,i         ;WARNING: Number of bytes allocated (2) not equal to number of bytes listed in trace tag (0).
         CPA     0,i         
         BREQ    terminer    
         STA     nombre,s    
         LDA     0,i         
addition:ADDA    nombre,s    
         SUBX    1,i         
         CPX     0,i         
         BREQ    terminer    
         BR      addition    
terminer:ADDSP   2,i         ;WARNING: Number of bytes deallocated (2) not equal to number of bytes listed in trace tag (0).
         RET0                
;
; Sous-programme: lgtMois
; description: programme qui determine le nombre de jours
; dans un mois a partir de la variable mois
; IN
; A= mois
; OUT
; X= nombre jours du mois
;
lgtmois: CPA     4,i         
         BREQ    court       
         CPA     6,i         
         BREQ    court       
         CPA     9,i         
         BREQ    court       
         CPA     11,i        
         BREQ    court       
         CPA     2,i         
         BREQ    fev         
         LDX     31,i        
         BR      reto        
court:   LDX     30,i        
         BR      reto        
tcourt:  LDX     29,i        
         BR      reto        
fev:     LDA     annee,d     
         SUBA    1900,i      
         LDX     4,i         
         CALL    divise      
         CPA     0,i         
         BREQ    tcourt      
         LDX     28,i        
reto:    RET0                
;divise: divise nombre donner en argument A par X
;In A = dividende
; X = diviseur
;OUT A = reste
; X = quotient
;Variables locales
diviser: .EQUATE 0           
divise:  SUBSP   2,i         ;allouer espace variables locales ;WARNING: Number of bytes allocated (2) not equal to number of bytes listed in trace tag (0).
         STX     diviser,s   
         LDX     0,i         
soustr:  ADDX    1,i         
         SUBA    diviser,s   
         BRGE    soustr      
         SUBX    1,i         
         ADDA    diviser,s   
         ADDSP   2,i         ;WARNING: Number of bytes deallocated (2) not equal to number of bytes listed in trace tag (0).
         RET0                
;Sous-Proramme d'affichage de fin
;
;affiche le message de fin et termine le programme
;
fin:     STRO    final,d     
         STOP                
bienvenu:.ASCII  "Bienvenue a ce programme d'affichage d'un calendrier.\x00"
manuel:  .ASCII  "\n\nCe programme affichera un calendrier pour l'annee et le mois"
         .ASCII  "\ndesire. Il faut entrez le mois desire sous la forme AAAAMM sans quoi"
         .ASCII  "\nle programme vous dira que c'est une entree invalide. De plus, seules"
         .ASCII  "\nles années comprises inclusivement entre 1901 et 2050 sont valides."
         .ASCII  "\nAucun espace ne peut apparaître avant, à l'intérieur ou après la date."
         .ASCII  "\nPour terminer le programme il faut appuyer uniquement sur ENTREE lors de la saisie\x00."
demande: .ASCII  "\n\nEntrez la date desiree: \x00"
final:   .ASCII  "\n\nFin normal du programme\x00"
entinval:.ASCII  "\n\nEntree invalide\n\x00"
compte:  .BLOCK  2           ;#2d
annee:   .BLOCK  2           ;#2d
mois:    .BLOCK  2           ;#2d
ind:     .BLOCK  2           
jours:   .BLOCK  2           
aaxx:    .BLOCK  2           
jourun:  .BLOCK  2           
jeuprem: .BLOCK  2           
jourspai:.BLOCK  3           
datedec: .BLOCK  8           
date:    .BLOCK  8           
TEXTE:   .ASCII  "JANVIER FEVRIER MARS AVRIL MAI JUIN JUILLET AOUT SEPTEMBRE OCTOBRE NOVEMBRE DECEMBRE D  L  M  M  J  V  S\n \x00"
CHIFFRES:.ASCII  " 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31   \x00"
TEXTPAIE:.ASCII  "Jours de paie: \x00"
SORTIE:  .BLOCK  500         
         .END                  